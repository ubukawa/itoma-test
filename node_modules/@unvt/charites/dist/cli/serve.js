"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const commander_1 = require("commander");
const serve_1 = require("../commands/serve");
const error_1 = require("../lib/error");
const defaultValues_1 = require("../lib/defaultValues");
const fs_1 = __importDefault(require("fs"));
const program = new commander_1.Command();
program
    .name('serve')
    .arguments('<source>')
    .description('serve your map locally')
    .option('--provider [provider]', 'your map service. e.g. `mapbox`, `geolonia`')
    .option('--mapbox-access-token [mapboxAccessToken]', 'Access Token for the Mapbox')
    .option('--port [port]', 'Specify custom port')
    .action((source, serveOptions) => {
    const options = program.opts();
    options.provider = serveOptions.provider;
    options.mapboxAccessToken = serveOptions.mapboxAccessToken;
    options.port = serveOptions.port;
    if (!fs_1.default.existsSync(defaultValues_1.defaultSettings.configFile)) {
        fs_1.default.writeFileSync(defaultValues_1.defaultSettings.configFile, `provider: ${options.provider || 'default'}`);
    }
    try {
        serve_1.serve(source, program.opts());
    }
    catch (e) {
        error_1.error(e);
    }
});
exports.default = program;
